3X-UI-pro with REALITY (panel and inbounds **3X-UI-pro with REALITY (panel and inbounds on port 443)**on port 443)
В прошлый раз, вот тут, я рассказывал как установить и настроить 3x-ui с обвязкой что бы все работало на порту 443, еще и с фейковым сайтом вместе. После этого я решил немного модернизировать этот скрипт, что бы поддерживались не только Trojan и Vless поверх вебсокетов но еще и REALITY с доменом маскировки на вашем же сервере

!!!Если ваш хостер поставляет виртуалки с QEMU Virtual CPU, попросите изменить его на модель хоста, т.к. как показала практика с дефолтным CPU это не работает, я запостил багу в nginx а так же нашел тред 12 летней давности где разработчики пишут что они не хотят и не будут .

Опытным путем было выяснено что клиенты работающие поверх ядра sing-box работают не со всеми типами подключений, например Trojan via grpc, у меня не до конца получилось разобраться почему так, но сам факт, если вам нужен этот тип подключения просто выбирите клиент на базе xray

Что новый скрипт делает
Устанавливает 3x-ui

Устанавливает и настраивает nginx для реверспроксирования не только самой панели но и инбаундов vless/trojan c транспортами WebSocket/GRPC так же инбаунда vless с транспортом REALITY и инбаунд xhttp

Создает два инбаунда vless+reality и vless+websocket

Включает подписки на порту 443

Получает и настраивает SSL сертификаты для доменов или сабдоменов

Устанавливает фейковый сайт

Настраивает фаервол, остаются открытыми только порты 22, 80 и 443

Зачем это нужно
Не нужно подбирать SNI для маскировки, маскируетесь под свои домены/поддомены

Все работает на одном порту, как панель, так и подключения

Отличная защита от пробберов, а они к сожалению уже гуляют, случаи что люди палили так или иначе свой сервер и там оставались рабочими только порты 22, 80 и 443

Ну и самый главный плюс, сайт под который вы маскируетесь находится на вашем же сервере, а это довольно важно для производительности связки vless+REALITY, ну и плюсом с данной настройкой ваше впн подключение для всех пробберов выглядит как работа с сайтом который расположен на том же сервере. Ваще ни к чем ни прикопаться.

Что понадобится
Чистый сервер c ОС Ubuntu 24

2 (ДВА) Домена или саб-домена для сервера, обязательно, должены работать до начала запуска скрипта, при заведении не забудьте привязать эти саб домены к IP адресу сервера. Где взять сабдомены бесплатно можно посмотреть здесь

Cloudflare не поддерживает проброс REALITY, поэтому если ваш домен скрыт cloudflare для корректной работы вам понадобится два сабдомена без проксирования. Для работы через Cloudflare подойдет только оригинальный скрипт. Следуйте либо моей инстуркции либо инструкции автора скрипта на гитхабе

Установка
Коннектимся к серверу по ssh

Запускаем команду (после прогона скрипта НЕ нужно будет настраивать протоколы и подписки вручную)
ㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤ
ㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤ

```
sudo su -c "bash <(wget -qO- https://raw.githubusercontent.com/kgorobets459-afk/script-3x-ui-mozaroc/main/x-ui-pro.sh) -install yes"
```
ㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤ
ㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤㅤ


Скрипт попросит указать ваши домены, сначала для панели, затем для реалити, указываем, ждем заверешения

По окончанию работы скрипт выдаст ссылку на вход и логин и пароль, сохраняем все это.

!!!Создавать подключения больше не нужно - они создаются автоматически, но оставлю здесь что бы можно было создать новое если случайно удалили!!!

Далее идем в подключения и создаем новый с типом vless транспортом tcp и безопасностью REALITY


Вот тут внимательно, указываем порт обязательно 8443, ни какой другой, nginx все запросы со SNI домена который вы указали как для reality будет перенаправлять только на этот порт


Вклюаем Proxy Protocol - это нужно для того что бы заработали лимиты по IP адресам если в будущем вы захотите их настроить. Конфиги nginx уже подготовлены для этого, поэтому он нужен, без него подключение не заработает


Включаем внешний прокси, домен указываем тот что используем для панели, порт 443

В поле Dest указываем домен под который маскируемся, и порт 9443, на этом порту по этому доменному имени слушает nginx и показывает фейковый сайт. В поле SNI указываем домен под который маскируемся

Не забываем сгенерировать сертификаты, сохраняем подключение, и можно зайти на домен под который маскируемся браузером и увидеть сайт заглушку, который так же покажется если зайти в чистом виде на домен панели.

Добавляем конфигурацию в клиента, пробуем, убеждаемся что все хорошо

Если не все хорошо, проверяем настройки, особенно что везде указали правильные порты, для протокола 8443 а в поле Dest 9443 . Проверяем импортированные настройки на клиенте, сервер должен быть указан доменом, порт 443. Настраиваем все заново, думаем, в общем ДЕБАГ

!!! Firewall уже настроен скриптом, но рекмоендуется сменить порт ssh c дефолтного 22-го!!!

откройте файл /etc/ssh/sshd_config Найдите в нем строчку Port 22, она может быть закоментирвоана и начинаться со знака #, удалите знак коментария если он есть, измените цифру порта на что-то свое.

Далее нужно разрешить этот порт на фаерволе, делается это командой -

ufw allow НОМЕР/tcp

ufw reload

далее перезапустите ssh командой

systemctl restart ssh

теперь отключитесь от сервера и подключитесь уже по новому порту, если подключаетесь из cmd то просто добавьте в конце команды на подключение -p НОМЕР

Как настроить vless и trojan на вебсокетах и grpc вот с этим же скриптом я рассказывал здесь https://scarce-hole-1e2.notion.site/X-UI-pro-script-1081666462e48069b35edf17d22894dc

Подписка
Подписка уже включена, ключи прописывать не нужно, портменять не нужно, путь менять не нужно - при смене нарушается связность с nginx. URI обратного прокси так же трогать не нужно

Клиенты и их ядра
Опытным путем было выяснено что клиенты работающие поверх ядра sing-box работают не со всеми типами подключений, например Trojan via grpc, у меня не до конца получилось разобраться почему так, но сам факт, если вам нужен этот тип подключения просто выбирите клиент на базе xray

Инструкция по настройке IP Limit

##############################################################

Ссылка для покупки VPS https://secure.veesp.com/?affid=860

Промокод TELEGA - не забудьте нажать на стрелочку после ввода

Ну и каменты и все прочее конечно приветствуется в телеге https://t.me/crazy_day_admin

А т.к. каменты стали жить отдельной жизнью, я завел отдельный чат, велкам https://t.me/crazyops_chat

